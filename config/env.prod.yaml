# ============================================================================
# SignUpFlow Production Environment Configuration
# ============================================================================
# This file defines the STRUCTURE and DEFAULTS for production environment.
# Sensitive values (passwords, keys) come from .env file.
#
# SECURITY WARNING: This file is committed to git. NEVER put secrets here!
#
# Usage:
#   1. Copy .env.example to .env
#   2. Fill in ALL sensitive values in .env (required for production)
#   3. Run: docker-compose -f docker-compose.prod.yml up
#
# Priority: .env values > this file defaults
# Committed to git: YES (no secrets here!)
# ============================================================================

environment: production

# ============================================================================
# Application
# ============================================================================
app:
  name: SignUpFlow
  version: 1.0.0
  debug: false  # ⚠️ NEVER enable debug in production
  reload: false  # No hot reload in production
  log_level: WARNING  # Only warnings and errors

  # URLs (override in .env with actual domain)
  url: https://app.signupflow.io
  api_base_url: https://api.signupflow.io
  frontend_url: https://app.signupflow.io

  # Server
  host: 0.0.0.0
  port: 8000
  workers: 4  # Multiple workers for production (CPU cores × 2)

# ============================================================================
# Database
# ============================================================================
database:
  # PostgreSQL (production instance)
  type: postgresql
  # host: FROM .env (POSTGRES_HOST) - managed database URL
  # port: FROM .env (POSTGRES_PORT) - typically 5432
  # name: FROM .env (POSTGRES_DB)
  # user: FROM .env (POSTGRES_USER)
  # password: FROM .env (POSTGRES_PASSWORD)

  # Connection Pool (production-grade)
  pool_size: 20  # Higher for multiple workers
  max_overflow: 40  # Handle traffic spikes
  pool_timeout: 30  # Connection timeout
  pool_recycle: 3600  # Recycle connections every hour

  # SSL/TLS (required for production)
  # ssl_mode: FROM .env (POSTGRES_SSL_MODE) - require/verify-full
  # ssl_cert_path: FROM .env (POSTGRES_SSL_CERT)

# ============================================================================
# Redis
# ============================================================================
redis:
  # host: FROM .env (REDIS_HOST) - managed Redis URL
  # port: FROM .env (REDIS_PORT)
  db: 0
  # password: FROM .env (REDIS_PASSWORD) - REQUIRED in production

  # Features
  enabled: true
  rate_limiting_enabled: true  # Critical for production
  session_ttl_hours: 24

  # SSL/TLS (if using managed Redis with TLS)
  # ssl: FROM .env (REDIS_SSL) - true/false
  # ssl_cert_reqs: FROM .env (REDIS_SSL_CERT_REQS)

# ============================================================================
# Authentication & Security
# ============================================================================
auth:
  # JWT
  # secret_key: FROM .env (SECRET_KEY) - MUST be strong random key (256-bit)
  algorithm: HS256
  access_token_expire_hours: 24

  # Password Reset
  password_reset_token_ttl: 3600  # 1 hour

  # reCAPTCHA (STRONGLY RECOMMENDED in production)
  recaptcha:
    enabled: true  # Enable to prevent abuse
    # site_key: FROM .env (RECAPTCHA_SITE_KEY)
    # secret_key: FROM .env (RECAPTCHA_SECRET_KEY)

  # Two-Factor Authentication (RECOMMENDED)
  totp:
    enabled: true  # Enable for enhanced security
    # encryption_key: FROM .env (TOTP_ENCRYPTION_KEY) - Fernet key

# ============================================================================
# Rate Limiting (STRICT for production)
# ============================================================================
rate_limiting:
  enabled: true  # ⚠️ CRITICAL - prevent abuse

  # Signup (prevent spam registrations)
  signup_max: 3  # Only 3 signups per IP per hour
  signup_window: 3600

  # Login (prevent brute force)
  login_max: 5  # 5 failed attempts per 5 minutes
  login_window: 300

  # Organization Creation
  create_org_max: 2
  create_org_window: 3600

  # Invitation (prevent invitation spam)
  create_invitation_max: 10
  create_invitation_window: 3600
  verify_invitation_max: 10
  verify_invitation_window: 300

  # Password Reset (prevent enumeration attacks)
  password_reset_max: 3
  password_reset_window: 3600
  password_reset_confirm_max: 5
  password_reset_confirm_window: 600

# ============================================================================
# Email (SendGrid for production)
# ============================================================================
email:
  enabled: true  # ⚠️ Required for password reset, invitations

  # SendGrid (recommended for production)
  provider: sendgrid
  # api_key: FROM .env (SENDGRID_API_KEY)

  # From Address
  # from_email: FROM .env (EMAIL_FROM_ADDRESS) - must be verified domain
  # from_name: FROM .env (EMAIL_FROM_NAME)

  # Email Templates
  # template_path: ./email_templates

# ============================================================================
# SMS (Twilio for production)
# ============================================================================
sms:
  enabled: true  # Enable for SMS notifications

  # Twilio
  provider: twilio
  # account_sid: FROM .env (TWILIO_ACCOUNT_SID)
  # auth_token: FROM .env (TWILIO_AUTH_TOKEN)
  # phone_number: FROM .env (TWILIO_PHONE_NUMBER) - verified number

  # Webhooks (must be HTTPS in production)
  # status_callback_url: FROM .env (TWILIO_STATUS_CALLBACK_URL)
  # incoming_sms_url: FROM .env (TWILIO_INCOMING_SMS_URL)

# ============================================================================
# Payment (Stripe - LIVE MODE)
# ============================================================================
billing:
  enabled: true  # ⚠️ Required for SaaS

  provider: stripe
  test_mode: false  # ⚠️ LIVE MODE in production
  # publishable_key: FROM .env (STRIPE_PUBLISHABLE_KEY) - pk_live_...
  # secret_key: FROM .env (STRIPE_SECRET_KEY) - sk_live_...
  # webhook_secret: FROM .env (STRIPE_WEBHOOK_SECRET) - whsec_...

  # Price IDs (LIVE mode price IDs)
  # prices:
  #   starter_monthly: FROM .env (STRIPE_PRICE_STARTER_MONTHLY)
  #   starter_annual: FROM .env (STRIPE_PRICE_STARTER_ANNUAL)
  #   pro_monthly: FROM .env (STRIPE_PRICE_PRO_MONTHLY)
  #   pro_annual: FROM .env (STRIPE_PRICE_PRO_ANNUAL)

# ============================================================================
# Features
# ============================================================================
features:
  calendar_export: true
  solver: true
  analytics: true
  mobile_app: true  # Enable mobile app support
  onboarding_wizard: true

# ============================================================================
# Monitoring (CRITICAL for production)
# ============================================================================
monitoring:
  # Sentry (error tracking)
  sentry:
    enabled: true  # ⚠️ REQUIRED for production error tracking
    # dsn: FROM .env (SENTRY_DSN)
    # environment: FROM .env (SENTRY_ENVIRONMENT) - production
    # release: FROM .env (SENTRY_RELEASE) - git commit SHA
    sample_rate: 1.0  # 100% of errors
    traces_sample_rate: 0.1  # 10% of performance traces

  # DataDog (optional - application performance monitoring)
  datadog:
    enabled: false
    # api_key: FROM .env (DATADOG_API_KEY)
    # app_key: FROM .env (DATADOG_APP_KEY)
    # service_name: FROM .env (DATADOG_SERVICE_NAME)

  # Health Checks
  health_check:
    enabled: true
    endpoint: /health
    interval_seconds: 30

# ============================================================================
# CORS (strict in production)
# ============================================================================
cors:
  # origins: FROM .env (CORS_ORIGINS) - comma-separated list
  # Example: https://app.signupflow.io,https://www.signupflow.io
  credentials: true
  max_age: 3600  # Cache preflight requests for 1 hour

# ============================================================================
# Security Headers (production-grade)
# ============================================================================
security:
  # HSTS (HTTP Strict Transport Security)
  hsts:
    enabled: true
    max_age: 31536000  # 1 year
    include_subdomains: true
    preload: true

  # Content Security Policy
  csp:
    enabled: true
    # policy: FROM .env (CSP_POLICY)

  # Rate limiting at application level
  request_timeout: 30  # 30 seconds max per request
  max_request_size: 10485760  # 10 MB max request size

# ============================================================================
# SSL/TLS Configuration
# ============================================================================
ssl:
  # enabled: FROM .env (SSL_ENABLED) - true
  # cert_path: FROM .env (SSL_CERT_PATH)
  # key_path: FROM .env (SSL_KEY_PATH)
  # Managed by reverse proxy (Traefik/nginx) in production

# ============================================================================
# Testing (disabled in production)
# ============================================================================
testing:
  enabled: false  # NO TESTING in production
  # All test settings disabled

# ============================================================================
# File Storage (S3 for production)
# ============================================================================
storage:
  type: s3  # Use S3 for production
  # aws_access_key_id: FROM .env (AWS_ACCESS_KEY_ID)
  # aws_secret_access_key: FROM .env (AWS_SECRET_ACCESS_KEY)
  # aws_region: FROM .env (AWS_REGION)
  # s3_bucket: FROM .env (S3_BUCKET_NAME)
  max_file_size: 10485760  # 10 MB

  # CDN (CloudFront)
  # cdn_url: FROM .env (CDN_URL)

# ============================================================================
# Backup & Recovery
# ============================================================================
backup:
  enabled: true
  # s3_backup_bucket: FROM .env (S3_BACKUP_BUCKET)
  # backup_schedule: FROM .env (BACKUP_SCHEDULE) - cron format
  retention_days: 30

# ============================================================================
# Logging (production-grade)
# ============================================================================
logging:
  level: WARNING  # Only warnings and errors
  format: json  # Structured logging for log aggregation

  output:
    - console  # Docker logs
    - file  # Persistent logs

  # Log aggregation (ELK, CloudWatch, etc.)
  # aggregation_endpoint: FROM .env (LOG_AGGREGATION_ENDPOINT)

  # Rotation
  file_path: /var/log/signupflow/app.log
  max_bytes: 10485760  # 10 MB per file
  backup_count: 10  # Keep 10 rotated files

# ============================================================================
# Performance Optimization
# ============================================================================
performance:
  # Database query optimization
  enable_query_logging: false  # Disable in production (performance cost)

  # Caching
  cache_ttl: 300  # 5 minutes default cache TTL

  # Compression
  gzip_compression: true
  gzip_min_size: 1024  # Compress responses > 1 KB

# ============================================================================
# Compliance & Privacy
# ============================================================================
compliance:
  # GDPR
  gdpr_enabled: true
  data_retention_days: 365  # 1 year

  # HIPAA (if handling health data)
  hipaa_enabled: false

  # SOC 2
  audit_logging_enabled: true
  audit_log_retention_days: 2555  # 7 years
