# ============================================================================
# SignUpFlow Test Environment Configuration
# ============================================================================
# This file defines the STRUCTURE and DEFAULTS for testing environment.
# Sensitive values (passwords, keys) come from .env file.
#
# Usage:
#   1. Copy .env.example to .env
#   2. Fill in sensitive values in .env
#   3. Run: make test-docker (uses this profile automatically)
#
# Priority: .env values > this file defaults
# Committed to git: YES (no secrets here!)
# ============================================================================

environment: testing

# ============================================================================
# Application
# ============================================================================
app:
  name: SignUpFlow
  version: 1.0.0
  debug: true  # Enable debug for test failures
  reload: false  # No hot reload during tests
  log_level: INFO  # Less verbose than dev

  # URLs
  url: http://localhost:8000
  api_base_url: http://localhost:8000
  frontend_url: http://localhost:8000

  # Server
  host: 0.0.0.0
  port: 8000
  workers: 1  # Single worker for predictable test behavior

# ============================================================================
# Database
# ============================================================================
database:
  # PostgreSQL (via Docker Compose)
  type: postgresql
  host: db
  port: 5432
  name: signupflow_test
  user: signupflow
  # password: FROM .env (POSTGRES_PASSWORD)

  # Connection Pool (smaller for tests)
  pool_size: 3
  max_overflow: 5

  # Test Database URL for pytest
  # test_database_url: FROM .env (TEST_DATABASE_URL)

# ============================================================================
# Redis
# ============================================================================
redis:
  host: redis
  port: 6379
  db: 1  # Use different DB than dev (db: 1 for tests)
  # password: FROM .env (REDIS_PASSWORD)

  # Features
  enabled: true
  rate_limiting_enabled: false  # Disable rate limiting in tests
  session_ttl_hours: 1  # Shorter TTL for tests

# ============================================================================
# Authentication & Security
# ============================================================================
auth:
  # JWT
  # secret_key: FROM .env (SECRET_KEY)
  algorithm: HS256
  access_token_expire_hours: 1  # Shorter expiry for tests

  # Password Reset
  password_reset_token_ttl: 300  # 5 minutes (faster tests)

  # reCAPTCHA
  recaptcha:
    enabled: false  # Always disable in tests
    # site_key: FROM .env (RECAPTCHA_SITE_KEY)
    # secret_key: FROM .env (RECAPTCHA_SECRET_KEY)

  # Two-Factor Authentication
  totp:
    enabled: false  # Disable in tests
    # encryption_key: FROM .env (TOTP_ENCRYPTION_KEY)

# ============================================================================
# Rate Limiting
# ============================================================================
rate_limiting:
  enabled: false  # Disable for fast test execution

  # Even if enabled, use very relaxed limits for tests
  signup_max: 1000
  signup_window: 3600
  login_max: 1000
  login_window: 300

# ============================================================================
# Email
# ============================================================================
email:
  enabled: false  # Disable email in tests unless explicitly testing

  # Mailtrap (for email tests if needed)
  provider: mailtrap
  smtp:
    host: sandbox.smtp.mailtrap.io
    port: 2525
    # user: FROM .env (MAILTRAP_SMTP_USER)
    # password: FROM .env (MAILTRAP_SMTP_PASSWORD)

  # Mailtrap API (for automated email verification in tests)
  api:
    # token: FROM .env (MAILTRAP_API_TOKEN)
    # account_id: FROM .env (MAILTRAP_ACCOUNT_ID)
    # inbox_id: FROM .env (MAILTRAP_INBOX_ID)

  # From Address
  from_email: test@signupflow.io
  from_name: SignUpFlow Test

# ============================================================================
# SMS
# ============================================================================
sms:
  enabled: false  # Disable in tests

  # Twilio
  provider: twilio
  # account_sid: FROM .env (TWILIO_ACCOUNT_SID)
  # auth_token: FROM .env (TWILIO_AUTH_TOKEN)
  # phone_number: FROM .env (TWILIO_PHONE_NUMBER)

# ============================================================================
# Payment (Stripe)
# ============================================================================
billing:
  enabled: false  # Disable billing in tests

  provider: stripe
  test_mode: true
  # publishable_key: FROM .env (STRIPE_PUBLISHABLE_KEY)
  # secret_key: FROM .env (STRIPE_SECRET_KEY)
  # webhook_secret: FROM .env (STRIPE_WEBHOOK_SECRET)

# ============================================================================
# Features
# ============================================================================
features:
  calendar_export: true
  solver: true
  analytics: false  # Disable analytics in tests
  mobile_app: false
  onboarding_wizard: true

# ============================================================================
# Monitoring
# ============================================================================
monitoring:
  # Sentry
  sentry:
    enabled: false  # Don't send test errors to Sentry
    # dsn: FROM .env (SENTRY_DSN)

# ============================================================================
# CORS
# ============================================================================
cors:
  origins:
    - http://localhost:8000
    - http://127.0.0.1:8000
    - http://localhost:3000
  credentials: true

# ============================================================================
# Testing Configuration
# ============================================================================
testing:
  enabled: true

  # Pytest Configuration
  test_database_url: postgresql://signupflow:test_password@db:5432/signupflow_test

  # Playwright Configuration
  playwright_browser: chromium
  playwright_headless: true  # Run headless in CI
  playwright_slow_mo: 0  # No artificial delays
  test_timeout: 30000  # 30 seconds per test

  # E2E Test Settings
  e2e:
    base_url: http://localhost:8000
    screenshot_on_failure: true
    video_on_failure: false  # Disable to save space
    trace_on_failure: true  # Enable traces for debugging

  # Test Data Management
  data:
    reset_between_tests: true  # Clean database between tests
    use_fixtures: true  # Load test fixtures
    faker_seed: 12345  # Deterministic fake data

  # Performance Testing
  performance:
    enabled: false  # Disable performance tests by default
    max_response_time_ms: 1000
    load_test_users: 10

# ============================================================================
# File Storage
# ============================================================================
storage:
  type: local
  local_path: ./test_uploads
  max_file_size: 10485760  # 10 MB

# ============================================================================
# Logging
# ============================================================================
logging:
  level: INFO  # Less verbose than dev, more than prod
  format: detailed
  output:
    - console
  # Save test logs to file for debugging
  test_log_file: test_logs/test_run.log
