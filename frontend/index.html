<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rostio - My Schedule</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Onboarding Screen -->
        <div id="onboarding-screen" class="screen">
            <div class="welcome-card">
                <h1>üóìÔ∏è Welcome to Rostio</h1>
                <p class="welcome-text">Join your organization and manage your schedule effortlessly</p>

                <div class="onboarding-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <h3>Join an Organization</h3>
                        <p>Find your church, league, or team</p>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <h3>Set Your Availability</h3>
                        <p>Block off times when you're unavailable</p>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <h3>View Your Schedule</h3>
                        <p>See your assignments and export to calendar</p>
                    </div>
                </div>

                <button class="btn btn-primary btn-large" onclick="startOnboarding()">Get Started ‚Üí</button>
                <p class="help-text">Already have an account? <a href="#" onclick="showLogin(); return false;">Sign in</a></p>
            </div>
        </div>

        <!-- Login Screen -->
        <div id="login-screen" class="screen hidden">
            <div class="form-container">
                <h2>Sign In</h2>
                <p class="subtitle">Welcome back! Sign in to access your schedule</p>

                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="login-email" placeholder="your@email.com" required autofocus>
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="login-password" placeholder="Enter your password" required>
                    </div>

                    <div id="login-error" class="error-message hidden"></div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-large">Sign In ‚Üí</button>
                    </div>
                </form>

                <p class="help-text">Don't have an account? <a href="#" onclick="startOnboarding(); return false;">Sign up</a></p>
            </div>
        </div>

        <!-- Join Organization -->
        <div id="join-screen" class="screen hidden">
            <div class="form-container">
                <h2>Join Your Organization</h2>
                <p class="subtitle">First, let's find your organization</p>

                <div id="org-list" class="org-selection">
                    <div class="loading">Loading organizations...</div>
                </div>

                <div class="divider">
                    <span>or</span>
                </div>

                <button class="btn btn-secondary" onclick="showCreateOrg()">Create New Organization</button>

                <div id="create-org-section" class="hidden">
                    <h3>Create Your Organization</h3>
                    <form onsubmit="createAndJoinOrg(event)">
                        <input type="text" id="new-org-name" placeholder="Organization Name (e.g., Grace Community Church)" required>
                        <input type="text" id="new-org-region" placeholder="Location (optional)">
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Create & Continue</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- User Profile Setup -->
        <div id="profile-screen" class="screen hidden">
            <div class="form-container">
                <h2>Tell Us About Yourself</h2>
                <p class="subtitle">This helps us assign you appropriately</p>

                <form onsubmit="createProfile(event)">
                    <input type="text" id="user-name" placeholder="Your Full Name" required>
                    <input type="email" id="user-email" placeholder="Email Address" required>
                    <input type="password" id="user-password" placeholder="Create Password (min 6 characters)" minlength="6" required>
                    <input type="tel" id="user-phone" placeholder="Phone Number (optional)">

                    <label>What roles can you help with?</label>
                    <div class="role-selector" id="role-selector">
                        <label class="role-option">
                            <input type="checkbox" value="volunteer"> Volunteer
                        </label>
                        <label class="role-option">
                            <input type="checkbox" value="leader"> Leader/Coordinator
                        </label>
                        <label class="role-option">
                            <input type="checkbox" value="musician"> Musician
                        </label>
                        <label class="role-option">
                            <input type="checkbox" value="tech"> Tech/AV
                        </label>
                        <label class="role-option">
                            <input type="checkbox" value="childcare"> Childcare
                        </label>
                        <label class="role-option">
                            <input type="checkbox" value="hospitality"> Hospitality
                        </label>
                        <label class="role-option admin-role">
                            <input type="checkbox" value="admin"> Administrator
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-large">Continue ‚Üí</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Main App -->
        <div id="main-app" class="screen hidden">
            <header class="app-header">
                <div class="header-content">
                    <div class="header-left">
                        <h1>My Schedule</h1>
                        <div class="org-selector">
                            <select id="org-dropdown" onchange="switchOrganization()" style="display: none;">
                                <!-- Organizations will be loaded here -->
                            </select>
                            <span id="org-name-display" class="org-badge"></span>
                        </div>
                    </div>
                    <div class="user-info">
                        <span id="user-name-display"></span>
                        <button class="btn-icon" onclick="showSettings()">‚öôÔ∏è</button>
                    </div>
                </div>
            </header>

            <nav class="main-nav">
                <button class="nav-btn active" data-view="calendar" onclick="switchView('calendar')">
                    üìÖ My Calendar
                </button>
                <button class="nav-btn" data-view="availability" onclick="switchView('availability')">
                    ‚è∞ Availability
                </button>
                <button class="nav-btn" data-view="schedule" onclick="switchView('schedule')">
                    üìä My Schedule
                </button>
                <button class="nav-btn admin-only hidden" data-view="admin" onclick="switchView('admin')">
                    üëë Admin Dashboard
                </button>
            </nav>

            <!-- Calendar View -->
            <div id="calendar-view" class="view-content active">
                <div class="view-header">
                    <h2>My Calendar</h2>
                    <div class="calendar-controls">
                        <select id="month-selector" onchange="loadCalendar()">
                            <option value="current">This Month</option>
                            <option value="next">Next Month</option>
                            <option value="all">Next 3 Months</option>
                        </select>
                        <button class="btn btn-primary" onclick="exportMyCalendar()">üì• Export to Calendar</button>
                    </div>
                </div>

                <div id="calendar-grid" class="calendar-container">
                    <div class="loading">Loading your calendar...</div>
                </div>
            </div>

            <!-- Availability View -->
            <div id="availability-view" class="view-content">
                <div class="view-header">
                    <h2>Set Your Availability</h2>
                    <p class="help-text">Block off times when you can't serve</p>
                </div>

                <div class="availability-form">
                    <h3>Add Time Off</h3>
                    <form onsubmit="addTimeOff(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label>From Date</label>
                                <input type="date" id="timeoff-start" required>
                            </div>
                            <div class="form-group">
                                <label>To Date</label>
                                <input type="date" id="timeoff-end" required>
                            </div>
                        </div>
                        <input type="text" id="timeoff-reason" placeholder="Reason (optional, e.g., Vacation, Family event)">
                        <button type="submit" class="btn btn-primary">Add Time Off</button>
                    </form>

                    <div id="timeoff-list" class="timeoff-list">
                        <h3>Your Blocked Dates</h3>
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Schedule View -->
            <div id="schedule-view" class="view-content">
                <div class="view-header">
                    <h2>My Upcoming Schedule</h2>
                    <div class="schedule-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="upcoming-count">0</div>
                            <div class="stat-label">Upcoming</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="this-month-count">0</div>
                            <div class="stat-label">This Month</div>
                        </div>
                    </div>
                </div>

                <div id="schedule-list" class="schedule-timeline">
                    <div class="loading">Loading your schedule...</div>
                </div>
            </div>

            <!-- Admin Dashboard View -->
            <div id="admin-view" class="view-content">
                <div class="view-header">
                    <h2>Admin Dashboard</h2>
                    <p class="help-text">Manage schedules, events, and people for your organization</p>
                </div>

                <div class="admin-dashboard">
                    <!-- Quick Stats -->
                    <div class="admin-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="admin-people-count">0</div>
                            <div class="stat-label">People</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="admin-events-count">0</div>
                            <div class="stat-label">Events</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="admin-solutions-count">0</div>
                            <div class="stat-label">Schedules</div>
                        </div>
                    </div>

                    <!-- Role Management -->
                    <div class="admin-section">
                        <h3>Role Management</h3>
                        <p class="help-text">Define custom roles for your organization</p>
                        <div class="admin-controls">
                            <button class="btn btn-primary" onclick="showAddRoleForm()">+ Add Role</button>
                        </div>
                        <div id="admin-roles-list" class="roles-list">
                            <div class="loading">Loading roles...</div>
                        </div>
                    </div>

                    <!-- Event Management -->
                    <div class="admin-section">
                        <h3>Event Management</h3>
                        <div class="admin-controls">
                            <button class="btn btn-primary" onclick="showCreateEventForm()">+ Create Event</button>
                            <button class="btn btn-secondary" onclick="loadAdminEvents()">üîÑ Refresh</button>
                        </div>
                        <div id="admin-events-list" class="admin-list">
                            <div class="loading">Loading events...</div>
                        </div>
                    </div>

                    <!-- Schedule Generation -->
                    <div class="admin-section">
                        <h3>Schedule Generation</h3>
                        <div class="solver-controls">
                            <button class="btn btn-primary btn-large" onclick="generateSchedule()">
                                üîÑ Generate Schedule
                            </button>
                            <p class="help-text">This will create assignments for all upcoming events</p>
                        </div>
                        <div id="solver-status" class="solver-status"></div>
                    </div>

                    <!-- People & Availability -->
                    <div class="admin-section">
                        <h3>People & Availability</h3>
                        <div id="admin-people-list" class="admin-list">
                            <div class="loading">Loading people...</div>
                        </div>
                    </div>

                    <!-- Generated Schedules -->
                    <div class="admin-section">
                        <h3>Generated Schedules</h3>
                        <div id="admin-solutions-list" class="admin-list">
                            <div class="loading">Loading schedules...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Event Modal -->
        <div id="create-event-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Create Event</h3>
                    <button class="btn-close" onclick="closeCreateEventForm()">√ó</button>
                </div>
                <div class="modal-body">
                    <form id="create-event-form" onsubmit="createEvent(event)">
                        <div class="form-group">
                            <label>Event Type</label>
                            <select id="event-type" required>
                                <option value="">Select type...</option>
                                <option value="Sunday Service">Sunday Service</option>
                                <option value="Worship Service">Worship Service</option>
                                <option value="Bible Study">Bible Study</option>
                                <option value="Prayer Meeting">Prayer Meeting</option>
                                <option value="Youth Group">Youth Group</option>
                                <option value="Board Meeting">Board Meeting</option>
                                <option value="Special Event">Special Event</option>
                                <option value="Other">Other (specify in title)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Title (optional, override type name)</label>
                            <input type="text" id="event-title" placeholder="e.g., Christmas Service, Easter Celebration">
                        </div>
                        <div class="form-group">
                            <label>Date & Time</label>
                            <input type="datetime-local" id="event-start" required>
                        </div>
                        <div class="form-group">
                            <label>Duration (hours)</label>
                            <input type="number" id="event-duration" value="2" min="0.5" step="0.5" required>
                        </div>
                        <div class="form-group">
                            <label>Occurs</label>
                            <select id="event-occurs" onchange="toggleRecurrenceOptions()">
                                <option value="once">Once</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                        <div id="recurrence-options" class="form-group" style="display: none;">
                            <label>End Date</label>
                            <input type="date" id="event-end-date">
                            <small style="color: var(--text-light); display: block; margin-top: 5px;">Leave blank for 1 year from start</small>
                        </div>
                        <div class="form-group">
                            <label>Location</label>
                            <input type="text" id="event-location" placeholder="Main Sanctuary, Fellowship Hall">
                        </div>
                        <div class="form-group">
                            <label>Roles Needed - Select all that apply</label>
                            <div class="role-selector" id="event-role-selector">
                                <!-- Roles will be loaded dynamically from org config -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeCreateEventForm()">Cancel</button>
                            <button type="submit" class="btn btn-primary">Create Event</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Settings</h3>
                    <button class="btn-close" onclick="closeSettings()">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="setting-item">
                        <label>Your Name</label>
                        <input type="text" id="settings-name" readonly>
                    </div>
                    <div class="setting-item">
                        <label>Email</label>
                        <input type="email" id="settings-email" readonly>
                    </div>
                    <div class="setting-item">
                        <label>Organization</label>
                        <input type="text" id="settings-org" readonly>
                    </div>
                    <div class="setting-item">
                        <label>Roles - Select all that apply</label>
                        <div class="role-selector" id="settings-role-selector">
                            <label class="role-option">
                                <input type="checkbox" value="volunteer"> Volunteer
                            </label>
                            <label class="role-option">
                                <input type="checkbox" value="leader"> Leader/Coordinator
                            </label>
                            <label class="role-option">
                                <input type="checkbox" value="musician"> Musician
                            </label>
                            <label class="role-option">
                                <input type="checkbox" value="tech"> Tech/AV
                            </label>
                            <label class="role-option">
                                <input type="checkbox" value="childcare"> Childcare
                            </label>
                            <label class="role-option">
                                <input type="checkbox" value="hospitality"> Hospitality
                            </label>
                            <label class="role-option">
                                <input type="checkbox" value="admin"> Admin
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="logout()">Sign Out</button>
                    <button class="btn btn-primary" onclick="saveSettings()">Save Changes</button>
                    <button class="btn btn-secondary" onclick="closeSettings()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Add Role Modal -->
        <div id="add-role-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Custom Role</h3>
                    <button class="btn-close" onclick="closeAddRoleForm()">√ó</button>
                </div>
                <div class="modal-body">
                    <form onsubmit="addCustomRole(event)">
                        <div class="form-group">
                            <label>Role Name</label>
                            <input type="text" id="role-name" placeholder="e.g., Usher, Greeter, Sound Tech" required>
                        </div>
                        <div class="form-group">
                            <label>Description (optional)</label>
                            <textarea id="role-description" rows="3" placeholder="Brief description of this role"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeAddRoleForm()">Cancel</button>
                            <button type="submit" class="btn btn-primary">Add Role</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="js/role-management.js"></script>
    <script src="js/recurring-events.js"></script>
    <script src="js/app-user.js"></script>
</body>
</html>
