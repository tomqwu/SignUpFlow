<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SignUpFlow - Volunteer scheduling made simple. AI-powered sign-up management for churches, sports leagues, and non-profits.">
    <meta name="keywords" content="volunteer signup, church scheduling, sports league management, volunteer coordination, AI scheduling">
    <meta name="author" content="SignUpFlow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://signupflow.io/">
    <meta property="og:title" content="SignUpFlow - Volunteer Scheduling Made Simple">
    <meta property="og:description" content="AI-powered sign-up management for churches, sports leagues, and non-profits.">
    <meta property="og:image" content="/images/signupflow-logo.svg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://signupflow.io/">
    <meta property="twitter:title" content="SignUpFlow - Volunteer Scheduling Made Simple">
    <meta property="twitter:description" content="AI-powered sign-up management for churches, sports leagues, and non-profits.">

    <title data-i18n="schedule.title">SignUpFlow - My Schedule</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="canonical" href="https://signupflow.io/">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/mobile.css">
    <script src="/js/debug.js"></script>
    <script src="/js/toast.js"></script>
    <script src="/js/form-validation.js"></script>
    <script src="/js/conflict-detection.js"></script>
    <script src="/js/search-filter.js"></script>
    <script src="/js/auth-fetch.js"></script>
    <script src="/js/router.js"></script>

    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "SignUpFlow",
        "description": "Volunteer scheduling made simple. AI-powered sign-up management for churches, sports leagues, and non-profits.",
        "url": "https://signupflow.io",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Web",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "AI-powered scheduling",
            "Volunteer sign-up management",
            "Availability tracking",
            "Calendar export",
            "Multi-language support"
        ]
    }
    </script>
</head>
<body>
    <div class="container">
        <!-- Onboarding Screen -->
        <div id="onboarding-screen" class="screen">
            <div class="welcome-card">
                <div class="language-selector-top">
                    <select id="welcome-language" onchange="changeLanguage(this.value)" class="language-dropdown">
                        <option value="en">English</option>
                        <option value="es">Espa√±ol</option>
                        <option value="zh-CN">‰∏≠Êñá</option>
                        <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                        <option value="tl">Tagalog</option>
                        <option value="vi">Ti·∫øng Vi·ªát</option>
                    </select>
                </div>
                <h1><img src="/images/signupflow-logo.svg" alt="SignUpFlow" style="height: 60px; vertical-align: middle; margin-right: 20px;"> <span data-i18n="auth.welcome_to_signupflow">Welcome to SignUpFlow</span></h1>
                <p class="welcome-text" data-i18n="auth.welcome_subtitle">Join your organization and manage your schedule effortlessly</p>

                <div class="onboarding-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <h3 data-i18n="auth.join_organization">Join an Organization</h3>
                        <p data-i18n="auth.join_organization_desc">Find your church, league, or team</p>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <h3 data-i18n="schedule.availability">Set Your Availability</h3>
                        <p data-i18n="schedule.availability_desc">Block off times when you're unavailable</p>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <h3 data-i18n="schedule.view_schedule">View Your Schedule</h3>
                        <p data-i18n="schedule.view_schedule_desc">See your assignments and export to calendar</p>
                    </div>
                </div>

                <button class="btn btn-primary btn-large" onclick="startOnboarding()" data-i18n="auth.get_started">Get Started ‚Üí</button>
                <p class="help-text"><span data-i18n="auth.already_have_account">Already have an account?</span> <a href="#" onclick="showLogin(); return false;" data-i18n="auth.sign_in_link">Sign in</a></p>
            </div>
        </div>

        <!-- Login Screen -->
        <div id="login-screen" class="screen hidden">
            <div class="form-container">
                <div class="language-selector-top">
                    <select id="login-language" onchange="changeLanguage(this.value)" class="language-dropdown">
                        <option value="en">English</option>
                        <option value="es">Espa√±ol</option>
                        <option value="zh-CN">‰∏≠Êñá</option>
                        <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                        <option value="tl">Tagalog</option>
                        <option value="vi">Ti·∫øng Vi·ªát</option>
                    </select>
                </div>
                <h2 data-i18n="auth.sign_in_title">Sign In</h2>
                <p class="subtitle" data-i18n="auth.welcome_back_subtitle">Welcome back! Sign in to access your schedule</p>

                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label data-i18n="common.labels.email">Email Address</label>
                        <input type="email" id="login-email" data-i18n-placeholder="auth.placeholder_email" placeholder="your@email.com" required autofocus>
                    </div>

                    <div class="form-group">
                        <label data-i18n="auth.password">Password</label>
                        <input type="password" id="login-password" data-i18n-placeholder="auth.placeholder_password" placeholder="Enter your password" required>
                    </div>

                    <div id="login-error" class="error-message hidden"></div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-large" data-i18n="auth.sign_in">Sign In ‚Üí</button>
                    </div>
                </form>

                <p class="help-text"><span data-i18n="auth.no_account">Don't have an account?</span> <a href="#" onclick="startOnboarding(); return false;"><span data-i18n="auth.signup_link">Sign up</span></a></p>
            </div>
        </div>

        <!-- Join Organization -->
        <div id="join-screen" class="screen hidden">
            <div class="form-container">
                <h2 data-i18n="auth.join_org">Join Your Organization</h2>
                <p class="subtitle" data-i18n="auth.find_your_organization">First, let's find your organization</p>

                <div id="org-list" class="org-selection">
                    <div class="loading"data-i18n="common.loading_orgs">Loading organizations...</div>
                </div>

                <div class="divider">
                    <span data-i18n="common.or">or</span>
                </div>

                <button class="btn btn-secondary" onclick="showCreateOrg()"><span data-i18n="auth.create_new_organization">Create New Organization</span></button>

                <div id="create-org-section" class="hidden">
                    <h3 data-i18n="auth.create_org">Create Your Organization</h3>
                    <form onsubmit="createAndJoinOrg(event)">
                        <input type="text" id="new-org-name" data-i18n-placeholder="auth.placeholder_org_name" placeholder="Organization Name" required>
                        <input type="text" id="new-org-region" data-i18n-placeholder="auth.placeholder_location" placeholder="Location (optional)">
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" data-i18n="common.buttons.create">Create & Continue</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- User Profile Setup -->
        <div id="profile-screen" class="screen hidden">
            <div class="form-container">
                <h2 data-i18n="auth.about_you">Tell Us About Yourself</h2>
                <p class="subtitle" data-i18n="auth.create_account_subtitle">Create your account to get started</p>

                <form onsubmit="createProfile(event)">
                    <input type="text" id="user-name" data-i18n-placeholder="common.placeholder_full_name" placeholder="Your Full Name" required>
                    <input type="email" id="user-email" data-i18n-placeholder="common.placeholder_email" placeholder="Email Address" required>
                    <input type="password" id="user-password" data-i18n-placeholder="auth.placeholder_create_password" placeholder="Create Password (min 6 characters)" minlength="6" required>
                    <input type="tel" id="user-phone" data-i18n-placeholder="common.placeholder_phone" placeholder="Phone Number (optional)">

                    <label data-i18n="auth.permission_level">Permission Level</label>
                    <div class="role-selector" id="role-selector">
                        <label class="role-option">
                            <input type="checkbox" value="volunteer" checked> <span data-i18n="common.volunteer">Volunteer</span>
                            <small class="form-help"><span data-i18n="auth.regular_member">Regular member</span></small>
                        </label>
                        <label class="role-option admin-role">
                            <input type="checkbox" value="admin"> <span data-i18n="common.administrator">Administrator</span>
                            <small class="form-help"><span data-i18n="auth.can_manage_org">Can manage organization and create events</span></small>
                        </label>
                    </div>
                    <p class="help-text">
                        <strong data-i18n="common.note">Note:</strong> You'll choose specific event roles (usher, greeter, etc.) when you join events.
                    </p>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-large" data-i18n="common.buttons.next">Continue ‚Üí</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Main App -->
        <div id="main-app" class="screen hidden">
            <header class="app-header">
                <div class="header-content">
                    <div class="header-left">
                        <div class="logo-container" onclick="goToHome()" style="cursor: pointer;"><img src="/images/signupflow-logo-white.svg" alt="SignUpFlow" class="header-logo"></div>
                        <div class="org-selector">
                            <select id="org-dropdown" onchange="switchOrganization()" style="display: none;">
                                <!-- Organizations will be loaded here -->
                            </select>
                            <span id="org-name-display" class="org-badge"></span>
                        </div>
                    </div>
                    <div class="user-info">
                        <select id="header-language" onchange="changeLanguage(this.value)" class="language-dropdown-header">
                            <option value="en">üåê EN</option>
                            <option value="es">üåê ES</option>
                            <option value="zh-CN">üåê ‰∏≠Êñá</option>
                            <option value="ko">üåê ÌïúÍµ≠Ïñ¥</option>
                            <option value="tl">üåê TL</option>
                            <option value="vi">üåê VI</option>
                        </select>
                        <span id="user-name-display"></span>
                        <button class="btn-icon" onclick="showSettings()">‚öôÔ∏è</button>
                    </div>
                </div>
            </header>

            <!-- Quick Profile & Context Panel -->
            <div class="profile-context-panel">
                <div class="context-card">
                    <div class="context-header">
                        <h3><span data-i18n="common.your_context">üìç Your Context</span></h3>
                        <button class="btn-link" onclick="showSettings()"><span data-i18n="common.edit_profile">Edit Profile ‚Üí</span></button>
                    </div>

                    <div class="context-grid">
                        <!-- Organization Section -->
                        <div class="context-item">
                            <label class="context-label" data-i18n="common.labels.organization">Organization</label>
                            <select id="org-dropdown-visible" onchange="switchOrganization()" class="org-select">
                                <option value="" data-i18n="common.loading">Loading...</option>
                            </select>
                            <p class="context-help"><span data-i18n="common.your_current_org">Your current organization</span></p>
                        </div>

                        <!-- Roles Section -->
                        <div class="context-item">
                            <label class="context-label"><span data-i18n="common.your_active_roles">Your Active Roles</span></label>
                            <div id="active-roles-display" class="role-badges">
                                <!-- Roles will be populated dynamically -->
                            </div>
                            <button class="btn-link btn-sm" onclick="showSettings()"><span data-i18n="common.add_edit_roles">+ Add/Edit Roles</span></button>
                            <p class="context-help"><span data-i18n="common.roles_determine_events">These determine which events you'll be scheduled for</p>
                        </div>

                        <!-- <span data-i18n="common.quick_actions">Quick Actions</span> -->
                        <div class="context-item">
                            <label class="context-label"><span data-i18n="common.quick_actions">Quick Actions</span></label>
                            <div class="quick-actions">
                                <button class="btn btn-sm btn-secondary" onclick="switchView('availability')">
                                    <span data-i18n="common.set_availability">‚è∞ Set Availability</span>
                                </button>
                                <button class="btn btn-sm btn-secondary" onclick="exportMyCalendar()">
                                    <span data-i18n="common.export_calendar">üì• Export Calendar</span>
                                </button>
                            </div>
                            <p class="context-help"><span data-i18n="common.manage_schedule_prefs">Manage your schedule preferences</span></p>
                        </div>
                    </div>

                    <!-- First-time user hint -->
                    <div id="setup-hint" class="setup-hint hidden">
                        <div class="hint-content">
                            <span class="hint-icon">üí°</span>
                            <div>
                                <strong data-i18n="auth.new_here">New here?</strong> <span data-i18n="auth.make_sure_to">Make sure to:</span>
                                <ol>
                                    <li data-i18n="auth.select_roles_above">Select your roles above</li>
                                    <li data-i18n="auth.set_availability_hint">Set your availability (click "Set Availability")</li>
                                    <li data-i18n="auth.check_schedule">Check your upcoming schedule</li>
                                </ol>
                            </div>
                            <button class="btn-close" onclick="dismissSetupHint()">√ó</button>
                        </div>
                    </div>
                </div>
            </div>

            <nav class="main-nav">
                <button class="nav-btn active" data-view="schedule" onclick="switchView('schedule')" data-i18n="schedule.my_schedule">
                    üìÖ My Schedule
                </button>
                <button class="nav-btn" data-view="events" onclick="switchView('events')" data-i18n="events.events">
                    üìÜ All Events
                </button>
                <button class="nav-btn" data-view="availability" onclick="switchView('availability')" data-i18n="schedule.availability">
                    ‚è∞ Availability
                </button>
                <button class="nav-btn admin-only hidden" data-view="admin" onclick="switchView('admin')" data-i18n="admin.dashboard">
                    üëë Admin Dashboard
                </button>
            </nav>

            <!-- My Schedule View -->
            <div id="schedule-view" class="view-content active">
                <div class="view-header">
                    <h2 data-i18n="schedule.my_schedule">My Schedule</h2>
                    <div class="schedule-controls">
                        <div class="schedule-stats">
                            <div class="stat-card">
                                <div class="stat-value" id="upcoming-count">0</div>
                                <div class="stat-label" data-i18n="schedule.upcoming">Upcoming</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="this-month-count">0</div>
                                <div class="stat-label" data-i18n="schedule.this_month">This Month</div>
                            </div>
                        </div>
                        <div class="schedule-actions">
                            <button class="btn btn-secondary" onclick="showCalendarSubscription()" data-i18n="schedule.subscribe">üîó Subscribe</button>
                            <button class="btn btn-primary" onclick="exportMyCalendar()" data-i18n="schedule.download_ics">üì• Export ICS</button>
                        </div>
                    </div>
                </div>

                <div id="schedule-list" class="schedule-timeline">
                    <div class="loading"><span data-i18n="schedule.loading_schedule">Loading your schedule...</span></div>
                </div>
            </div>

            <!-- All Events View -->
            <div id="events-view" class="view-content">
                <div class="view-header">
                    <h2 data-i18n="events.title">All Organization Events</h2>
                    <p class="help-text"><span data-i18n="events.see_all_upcoming">See all upcoming events and who's scheduled</p>
                </div>

                <div class="events-filter">
                    <select id="events-month-filter" onchange="loadAllEvents()">
                        <option value="current" data-i18n="schedule.this_month">This Month</option>
                        <option value="next" data-i18n="schedule.next_month">Next Month</option>
                        <option value="all" data-i18n="schedule.all_upcoming">All Upcoming</option>
                    </select>
                </div>

                <div id="all-events-list" class="events-list">
                    <div class="loading"><span data-i18n="events.loading_events">Loading events...</span></div>
                </div>
            </div>

            <!-- Availability View -->
            <div id="availability-view" class="view-content">
                <div class="view-header">
                    <h2 data-i18n="schedule.availability">Set Your Availability</h2>
                    <p class="help-text" data-i18n="schedule.block_off_times">Block off times when you can't serve</p>
                </div>

                <div class="availability-form">
                    <h3 data-i18n="schedule.add_time_off">Add Time Off</h3>
                    <form onsubmit="addTimeOff(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label data-i18n="common.labels.from_date">From Date</label>
                                <input type="date" id="timeoff-start" required>
                            </div>
                            <div class="form-group">
                                <label data-i18n="common.labels.to_date">To Date</label>
                                <input type="date" id="timeoff-end" required>
                            </div>
                        </div>
                        <input type="text" id="timeoff-reason" data-i18n-placeholder="schedule.placeholder_reason" placeholder="Reason (optional)">
                        <button type="submit" class="btn btn-primary" data-i18n="schedule.add_time_off">Add Time Off</button>
                    </form>

                    <div id="timeoff-list" class="timeoff-list">
                        <h3 data-i18n="schedule.blocked_dates">Your Blocked Dates</h3>
                        <div class="loading" data-i18n="common.loading">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Edit Time Off Modal -->
            <div id="edit-timeoff-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 data-i18n="schedule.edit_timeoff">Edit Blocked Date</h3>
                        <button class="btn-close" onclick="closeEditTimeOffModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form id="edit-timeoff-form" onsubmit="saveEditedTimeOff(event)">
                            <input type="hidden" id="edit-timeoff-id">
                            <div class="form-group">
                                <label data-i18n="common.labels.from_date">From Date</label>
                                <input type="date" id="edit-timeoff-start" required>
                            </div>
                            <div class="form-group">
                                <label data-i18n="common.labels.to_date">To Date</label>
                                <input type="date" id="edit-timeoff-end" required>
                            </div>
                            <div class="form-group">
                                <label data-i18n="schedule.reason_optional">Reason (optional)</label>
                                <input type="text" id="edit-timeoff-reason" data-i18n-placeholder="schedule.placeholder_reason_example" placeholder="e.g., Vacation, Family event">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" onclick="closeEditTimeOffModal()" data-i18n="common.buttons.cancel">Cancel</button>
                                <button type="submit" class="btn btn-primary" data-i18n="common.buttons.save">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Admin Dashboard View -->
            <div id="admin-view" class="view-content">
                <div class="view-header">
                    <h2 data-i18n="admin.admin_console">Admin Console</h2>
                    <p class="help-text"><span data-i18n="admin.manage_your_org">Manage your organization</span></p>
                </div>

                <!-- Admin Tabs Navigation -->
                <div class="admin-tabs">
                    <button class="admin-tab-btn active" data-tab="events" onclick="switchAdminTab('events')" data-i18n="events.events">
                        Events
                    </button>
                    <button class="admin-tab-btn" data-tab="roles" onclick="switchAdminTab('roles')" data-i18n="admin.roles">
                        Roles
                    </button>
                    <button class="admin-tab-btn" data-tab="schedule" onclick="switchAdminTab('schedule')" data-i18n="schedule.schedule">
                        Schedule
                    </button>
                    <button class="admin-tab-btn" data-tab="people" onclick="switchAdminTab('people')" data-i18n="admin.tabs.people">
                        People
                    </button>
                    <button class="admin-tab-btn" data-tab="reports" onclick="switchAdminTab('reports')" data-i18n="admin.tabs.reports">
                        Reports
                    </button>
                </div>

                <div class="admin-dashboard">
                    <!-- Events Tab -->
                    <div id="admin-tab-events" class="admin-tab-content active">
                        <div class="admin-section">
                            <div class="admin-section-header">
                                <h3><span data-i18n="admin.event_management">Event Management</span></h3>
                                <div class="admin-controls">
                                    <button class="btn btn-primary" onclick="showCreateEventForm()"><span data-i18n="admin.create_event_button">+ Create Event</span></button>
                                    <button class="btn btn-secondary" onclick="loadAdminEvents()"><span data-i18n="common.refresh">üîÑ Refresh</span></button>
                                </div>
                            </div>
                            <div class="admin-stats-inline">
                                <div class="stat-card-inline">
                                    <span class="stat-label-inline"><span data-i18n="admin.total_events">Total Events:</span></span>
                                    <span class="stat-value-inline" id="admin-events-count">0</span>
                                </div>
                            </div>
                            <div id="admin-events-list" class="admin-list">
                                <div class="loading"><span data-i18n="events.loading_events">Loading events...</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Roles Tab -->
                    <div id="admin-tab-roles" class="admin-tab-content">
                        <div class="admin-section">
                            <div class="admin-section-header">
                                <h3><span data-i18n="admin.role_management">Role Management</span></h3>
                                <div class="admin-controls">
                                    <button class="btn btn-primary" onclick="showAddRoleForm()">+ Add Role</button>
                                </div>
                            </div>
                            <p class="help-text"><span data-i18n="admin.define_custom_roles">Define custom roles for your organization</span></p>
                            <div id="admin-roles-list" class="roles-list">
                                <div class="loading"><span data-i18n="admin.loading_roles">Loading roles...</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Schedule Tab -->
                    <div id="admin-tab-schedule" class="admin-tab-content">
                        <div class="admin-section">
                            <div class="admin-section-header">
                                <h3 data-i18n="solver.schedule_generation">Schedule Generation</h3>
                            </div>
                            <div class="solver-controls">
                                <button class="btn btn-primary btn-large" onclick="generateSchedule()">
                                    üîÑ Generate Schedule
                                </button>
                                <p class="help-text" data-i18n="solver.create_assignments_desc">This will create assignments for all upcoming events</p>
                            </div>
                            <div id="solver-status" class="solver-status"></div>

                            <!-- Calendar View -->
                            <div class="admin-calendar-section">
                                <h4 data-i18n="solver.schedule_calendar">Schedule Calendar</h4>
                                <div id="admin-calendar-view" class="admin-calendar">
                                    <div class="loading" data-i18n="solver.generate_first">Generate a schedule to see the calendar</div>
                                </div>
                            </div>
                        </div>

                        <!-- Generated Schedules List -->
                        <div class="admin-section">
                            <div class="admin-section-header">
                                <h3 data-i18n="solver.generated_schedules">Generated Schedules</h3>
                            </div>
                            <div class="admin-stats-inline">
                                <div class="stat-card-inline">
                                    <span class="stat-label-inline" data-i18n="solver.total_schedules">Total Schedules:</span>
                                    <span class="stat-value-inline" id="admin-solutions-count">0</span>
                                </div>
                            </div>
                            <div id="admin-solutions-list" class="admin-list">
                                <div class="loading" data-i18n="solver.loading_schedules">Loading schedules...</div>
                            </div>
                        </div>
                    </div>

                    <!-- People Tab -->
                    <div id="admin-tab-people" class="admin-tab-content">
                        <div class="admin-section">
                            <div class="admin-section-header">
                                <h3 data-i18n="admin.people_invitations">People <h3>People & Invitations</h3> Invitations</h3>
                                <div class="admin-controls">
                                    <button class="btn btn-primary" onclick="showInviteUserModal()">+ Invite User</button>
                                </div>
                            </div>
                            <div class="admin-stats-inline">
                                <div class="stat-card-inline">
                                    <span class="stat-label-inline" data-i18n="admin.total_people">Total People:</span>
                                    <span class="stat-value-inline" id="admin-people-count">0</span>
                                </div>
                            </div>

                            <!-- Invitation Status Dashboard -->
                            <div class="invitations-dashboard">
                                <h4 data-i18n="admin.invitation_status">Invitation Status</h4>
                                <div id="invitations-summary" class="invitations-summary">
                                    <div class="invitation-stat">
                                        <span class="invitation-count" id="pending-invitations">0</span>
                                        <span class="invitation-label" data-i18n="admin.pending">Pending</span>
                                    </div>
                                    <div class="invitation-stat">
                                        <span class="invitation-count" id="accepted-invitations">0</span>
                                        <span class="invitation-label" data-i18n="admin.accepted">Accepted</span>
                                    </div>
                                    <div class="invitation-stat">
                                        <span class="invitation-count" id="expired-invitations">0</span>
                                        <span class="invitation-label" data-i18n="admin.expired">Expired</span>
                                    </div>
                                </div>
                                <div id="invitations-list" class="invitations-list">
                                    <div class="loading" data-i18n="admin.loading_invitations">Loading invitations...</div>
                                </div>
                            </div>

                            <!-- People List -->
                            <h4 data-i18n="admin.team_members">Team Members</h4>
                            <div id="admin-people-list" class="admin-list">
                                <div class="loading" data-i18n="admin.loading_people">Loading people...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Reports Tab -->
                    <div id="admin-tab-reports" class="admin-tab-content">
                        <div class="admin-section">
                            <div class="admin-section-header">
                                <h3 data-i18n="admin.reports_export">Reports <h3>Reports & Export</h3> Export</h3>
                            </div>
                            <p class="help-text" data-i18n="admin.export_schedules_desc">Export schedules and generate reports</p>

                            <div class="reports-grid">
                                <div class="report-card">
                                    <h4 data-i18n="admin.pdf_schedule_export">PDF Schedule Export</h4>
                                    <p data-i18n="admin.download_printable">Download a printable schedule for distribution</p>
                                    <button class="btn btn-primary" onclick="exportLatestSchedulePDF()">üì• Export PDF</button>
                                </div>
                                <div class="report-card">
                                    <h4 data-i18n="admin.calendar_export_ics">Calendar Export (ICS)</h4>
                                    <p data-i18n="admin.export_all_events">Export all organization events to calendar</p>
                                    <button class="btn btn-primary" onclick="exportOrgCalendar()">üìÖ Export ICS</button>
                                </div>
                                <div class="report-card">
                                    <h4 data-i18n="admin.schedule_statistics">Schedule Statistics</h4>
                                    <p data-i18n="admin.view_distribution">View assignment distribution and metrics</p>
                                    <button class="btn btn-secondary" onclick="showScheduleStats()">üìä View Stats</button>
                                </div>
                            </div>

                            <!-- Statistics Display -->
                            <div id="schedule-stats-display" class="stats-display hidden">
                                <h4 data-i18n="admin.schedule_statistics">Schedule Statistics</h4>
                                <div id="stats-content" class="stats-content">
                                    <div class="loading" data-i18n="admin.loading_statistics">Loading statistics...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Event Modal -->
        <div id="create-event-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="events.create_event">Create Event</h3>
                    <button class="btn-close" onclick="closeCreateEventForm()">√ó</button>
                </div>
                <div class="modal-body">
                    <form id="create-event-form" onsubmit="window.createEvent(event); return false;">
                        <div class="form-group">
                            <label data-i18n="events.event_type">Event Type</label>
                            <select id="event-type" required>
                                <option value="" data-i18n="events.select_type">Select type...</option>
                                <option value="Sunday Service" data-i18n="events.type_sunday_service">Sunday Service</option>
                                <option value="Worship Service" data-i18n="events.type_worship_service">Worship Service</option>
                                <option value="Bible Study" data-i18n="events.type_bible_study">Bible Study</option>
                                <option value="Prayer Meeting" data-i18n="events.type_prayer_meeting">Prayer Meeting</option>
                                <option value="Youth Group" data-i18n="events.type_youth_group">Youth Group</option>
                                <option value="Board Meeting" data-i18n="events.type_board_meeting">Board Meeting</option>
                                <option value="Special Event" data-i18n="events.type_special_event">Special Event</option>
                                <option value="Other" data-i18n="events.type_other_specify">Other (specify in title)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label data-i18n="events.title_optional">Title (optional, override type name)</label>
                            <input type="text" id="event-title" data-i18n-placeholder="events.placeholder_title" placeholder="e.g., Christmas Service">
                        </div>
                        <div class="form-group">
                            <label data-i18n="events.date_time">Date & Time</label>
                            <input type="datetime-local" id="event-start" required>
                        </div>
                        <div class="form-group">
                            <label data-i18n="events.duration">Duration (hours)</label>
                            <input type="number" id="event-duration" value="2" min="0.5" step="0.5" required>
                        </div>
                        <div class="form-group">
                            <label data-i18n="events.occurs">Occurs</label>
                            <select id="event-occurs" onchange="toggleRecurrenceOptions()">
                                <option value="once" data-i18n="events.once">Once</option>
                                <option value="daily" data-i18n="events.daily">Daily</option>
                                <option value="weekly" data-i18n="events.weekly">Weekly</option>
                                <option value="monthly" data-i18n="events.monthly">Monthly</option>
                            </select>
                        </div>
                        <div id="recurrence-options" class="form-group" style="display: none;">
                            <label data-i18n="events.end_date">End Date</label>
                            <input type="date" id="event-end-date">
                            <small style="color: var(--text-light); display: block; margin-top: 5px;" data-i18n="events.end_date_hint">Leave blank for 1 year from start</small>
                        </div>
                        <div class="form-group">
                            <label data-i18n="events.location">Location</label>
                            <input type="text" id="event-location" data-i18n-placeholder="events.placeholder_location" placeholder="Main Sanctuary, Fellowship Hall">
                        </div>
                        <div class="form-group">
                            <label data-i18n="events.roles_needed">Roles Needed - Select all that apply</label>
                            <div class="role-selector" id="event-role-selector">
                                <!-- Roles will be loaded dynamically from org config -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeCreateEventForm()" data-i18n="common.buttons.cancel">Cancel</button>
                            <button type="submit" class="btn btn-primary" data-i18n="events.create_event">Create Event</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="settings.title">Settings</h3>
                    <button class="btn-close" onclick="closeSettings()">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="setting-item">
                        <label data-i18n="settings.name">Your Name</label>
                        <input type="text" id="settings-name" readonly>
                    </div>
                    <div class="setting-item">
                        <label data-i18n="settings.email">Email</label>
                        <input type="email" id="settings-email" readonly>
                    </div>
                    <div class="setting-item">
                        <label data-i18n="settings.organization">Organization</label>
                        <input type="text" id="settings-org" readonly>
                    </div>
                    <div class="setting-item">
                        <label data-i18n="settings.timezone">Timezone</label>
                        <select id="settings-timezone">
                            <option value="UTC">UTC</option>
                            <option value="America/New_York" data-i18n="settings.tz_eastern">Eastern Time</option>
                            <option value="America/Chicago" data-i18n="settings.tz_central">Central Time</option>
                            <option value="America/Denver" data-i18n="settings.tz_mountain">Mountain Time</option>
                            <option value="America/Los_Angeles" data-i18n="settings.tz_pacific">Pacific Time</option>
                            <option value="America/Anchorage" data-i18n="settings.tz_alaska">Alaska Time</option>
                            <option value="Pacific/Honolulu" data-i18n="settings.tz_hawaii">Hawaii Time</option>
                            <option value="Europe/London" data-i18n="settings.tz_london">London</option>
                            <option value="Europe/Paris" data-i18n="settings.tz_paris">Paris</option>
                            <option value="Asia/Tokyo" data-i18n="settings.tz_tokyo">Tokyo</option>
                            <option value="Asia/Shanghai" data-i18n="settings.tz_shanghai">Shanghai</option>
                            <option value="Asia/Dubai" data-i18n="settings.tz_dubai">Dubai</option>
                            <option value="Australia/Sydney" data-i18n="settings.tz_sydney">Sydney</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label data-i18n="settings.language">Language</label>
                        <select id="settings-language" onchange="changeLanguage(this.value)">
                            <option value="en" data-i18n="settings.lang_english">English</option>
                            <option value="es" data-i18n="settings.lang_spanish">Espa√±ol</option>
                            <option value="pt" data-i18n="settings.lang_portuguese">Portugu√™s</option>
                            <option value="fr" data-i18n="settings.lang_french">Fran√ßais</option>
                            <option value="zh-CN">‰∏≠Êñá (ÁÆÄ‰Ωì)</option>
                            <option value="zh-TW">‰∏≠Êñá (ÁπÅÈ´î)</option>
                        </select>
                        <p class="help-text">
                            <span data-i18n="settings.language_change_note">Changes take effect immediately</span>
                        </p>
                    </div>
                    <div class="setting-item">
                        <label data-i18n="settings.permission_level">Permission Level</label>
                        <div id="settings-permission-display" style="padding: 10px; background: var(--surface); border-radius: 4px; color: var(--text-light);">
                            <!-- Permissions are set by administrators -->
                        </div>
                        <p class="help-text">
                            <span data-i18n="settings.permission_note">Your permission level is set by an administrator. Event-specific roles are selected when you join individual events.</span>
                        </p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="logout()" data-i18n="settings.logout">Sign Out</button>
                    <button class="btn btn-primary" onclick="saveSettings()" data-i18n="settings.save_changes">Save Changes</button>
                    <button class="btn btn-secondary" onclick="closeSettings()" data-i18n="common.buttons.cancel">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Add Role Modal -->
        <div id="add-role-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="admin.add_custom_role">Add Custom Role</h3>
                    <button class="btn-close" onclick="closeAddRoleForm()">√ó</button>
                </div>
                <div class="modal-body">
                    <form onsubmit="addCustomRole(event)">
                        <div class="form-group">
                            <label data-i18n="admin.role_name">Role Name</label>
                            <input type="text" id="role-name" data-i18n-placeholder="admin.placeholder_role_name" placeholder="e.g., Usher, Greeter" required>
                        </div>
                        <div class="form-group">
                            <label data-i18n="admin.description_optional">Description (optional)</label>
                            <textarea id="role-description" rows="3" data-i18n-placeholder="admin.placeholder_role_desc" placeholder="Brief description of this role"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeAddRoleForm()" data-i18n="common.buttons.cancel">Cancel</button>
                            <button type="submit" class="btn btn-primary" data-i18n="admin.add_role">Add Role</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Edit Person Roles Modal -->
        <div id="edit-person-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="admin.edit_roles_for">Edit Roles for <span id="edit-person-name"></span></h3>
                    <button class="btn-close" onclick="closeEditPersonModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <form id="edit-person-form" onsubmit="updatePersonRoles(event)">
                        <input type="hidden" id="edit-person-id">
                        <div class="form-group">
                            <label data-i18n="admin.roles">Roles</label>
                            <div id="edit-person-roles-checkboxes" class="role-selector">
                                <!-- Role checkboxes will be dynamically populated -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeEditPersonModal()" data-i18n="common.buttons.cancel">Cancel</button>
                            <button type="submit" class="btn btn-primary" data-i18n="common.buttons.save">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Edit Role Modal -->
        <div id="edit-role-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="admin.edit_role">Edit Role</h3>
                    <button class="btn-close" onclick="closeEditRoleModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <form id="edit-role-form" onsubmit="saveEditRole(event)">
                        <input type="hidden" id="edit-role-old-name">
                        <div class="form-group">
                            <label for="edit-role-name" data-i18n="admin.role_name">Role Name</label>
                            <input type="text" id="edit-role-name" class="form-control" required>
                            <small class="form-help" data-i18n="admin.role_name_hint">Use lowercase with underscores (e.g., worship_leader)</small>
                        </div>
                        <div class="form-group">
                            <label for="edit-role-description" data-i18n="admin.description">Description</label>
                            <textarea id="edit-role-description" class="form-control" rows="3" data-i18n-placeholder="admin.placeholder_optional_desc" placeholder="Optional description"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeEditRoleModal()" data-i18n="common.buttons.cancel">Cancel</button>
                            <button type="submit" class="btn btn-primary" data-i18n="common.buttons.save">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Manage Role People Modal -->
        <div id="manage-role-people-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="admin.manage_people_for">Manage People for <span id="manage-role-name"></span></h3>
                    <button class="btn-close" onclick="closeManageRolePeopleModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <form id="manage-role-people-form" onsubmit="saveRolePeople(event)">
                        <input type="hidden" id="manage-role-id">
                        <div class="form-group">
                            <label data-i18n="admin.select_people_with_role">Select people who should have this role:</label>
                            <div id="manage-role-people-checkboxes" class="role-selector">
                                <!-- People checkboxes will be dynamically populated -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeManageRolePeopleModal()" data-i18n="common.buttons.cancel">Cancel</button>
                            <button type="submit" class="btn btn-primary" data-i18n="common.buttons.save">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Assignment Modal -->
        <div id="assignment-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="events.assign_people">Assign People to Event</h3>
                    <button class="btn-close" onclick="closeAssignmentModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <div id="assignment-people-list"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeAssignmentModal()" data-i18n="common.buttons.done">Done</button>
                </div>
            </div>
        </div>

        <!-- Invite User Modal -->
        <div id="invite-user-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="admin.invite_user">Invite User</h3>
                    <button class="btn-close" onclick="closeInviteUserModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <form id="invite-user-form" onsubmit="sendInvitation(event)">
                        <div class="form-group">
                            <label data-i18n="common.labels.email">Email Address</label>
                            <input type="email" id="invite-email" data-i18n-placeholder="admin.placeholder_email" placeholder="user@example.com" required>
                        </div>
                        <div class="form-group">
                            <label data-i18n="common.labels.full_name">Full Name</label>
                            <input type="text" id="invite-name" data-i18n-placeholder="admin.placeholder_name" placeholder="John Doe" required>
                        </div>
                        <div class="form-group">
                            <label data-i18n="admin.assign_roles">Assign Roles</label>
                            <div class="role-selector" id="invite-role-selector">
                                <label class="role-option">
                                    <input type="checkbox" value="volunteer"> <span data-i18n="common.volunteer">Volunteer</span>
                                </label>
                                <label class="role-option">
                                    <input type="checkbox" value="admin"> <span data-i18n="common.admin">Admin</span>
                                </label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeInviteUserModal()" data-i18n="common.buttons.cancel">Cancel</button>
                            <button type="submit" class="btn btn-primary" data-i18n="admin.send_invitation">Send Invitation</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Calendar Subscription Modal -->
        <div id="calendar-subscription-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="schedule.subscribe_to_calendar">Subscribe to Calendar</h3>
                    <button class="close-btn" onclick="closeCalendarSubscriptionModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <p class="help-text" data-i18n="schedule.subscription_help">
                        Subscribe to your schedule in Google Calendar, Apple Calendar, Outlook, or any other calendar app.
                        Your calendar will automatically update when your schedule changes.
                    </p>

                    <div class="form-group">
                        <label data-i18n="schedule.subscription_url_webcal">Subscription URL (webcal://)</label>
                        <div class="input-group">
                            <input type="text" id="webcal-url" readonly class="subscription-url">
                            <button class="btn btn-secondary" onclick="copyToClipboard('webcal-url')" data-i18n="common.buttons.copy">Copy</button>
                        </div>
                        <small class="help-text" data-i18n="schedule.webcal_hint">Use this URL in most calendar apps</small>
                    </div>

                    <div class="form-group">
                        <label data-i18n="schedule.alternative_url_https">Alternative URL (https://)</label>
                        <div class="input-group">
                            <input type="text" id="https-url" readonly class="subscription-url">
                            <button class="btn btn-secondary" onclick="copyToClipboard('https-url')" data-i18n="common.buttons.copy">Copy</button>
                        </div>
                        <small class="help-text" data-i18n="schedule.https_hint">Use this if webcal:// doesn't work</small>
                    </div>

                    <div class="calendar-instructions">
                        <h4 data-i18n="schedule.how_to_subscribe">How to subscribe:</h4>
                        <ul>
                            <li><strong data-i18n="schedule.google_calendar">Google Calendar:</strong> Settings ‚Üí Add calendar ‚Üí From URL</li>
                            <li><strong data-i18n="schedule.apple_calendar">Apple Calendar:</strong> File ‚Üí New Calendar Subscription</li>
                            <li><strong data-i18n="schedule.outlook">Outlook:</strong> Calendar ‚Üí Add calendar ‚Üí Subscribe from web</li>
                        </ul>
                    </div>

                    <div class="alert alert-warning">
                        <strong data-i18n="schedule.security_note_title">Security Note:</strong> <span data-i18n="schedule.security_note_text">Keep this URL private. Anyone with this URL can view your schedule.</span>
                        <button class="btn btn-link" onclick="resetCalendarToken()" data-i18n="schedule.reset_url">Reset URL</button> <span data-i18n="schedule.if_compromised">if compromised.</span>
                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeCalendarSubscriptionModal()" data-i18n="common.buttons.close">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Select Role for Event Modal -->
        <div id="select-role-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="events.select_your_role">Select Your Role</h3>
                    <button class="btn-close" onclick="closeSelectRoleModal()">√ó</button>
                </div>
                <div class="modal-body">
                    <p class="help-text" data-i18n="events.role_question">What role will you fulfill for this event?</p>
                    <form id="select-role-form" onsubmit="submitEventRole(event)">
                        <input type="hidden" id="role-event-id">
                        <div class="form-group">
                            <label for="event-role-select" data-i18n="admin.role">Role</label>
                            <select id="event-role-select" class="form-control" required>
                                <option value="">-- Select a role --</option>
                                <option value="usher" data-i18n="events.role_usher">Usher</option>
                                <option value="greeter" data-i18n="events.role_greeter">Greeter</option>
                                <option value="sound_tech"><span data-i18n="events.role_sound_tech">Sound Tech</span></option>
                                <option value="video_tech"><span data-i18n="events.role_video_tech">Video Tech</span></option>
                                <option value="worship_leader"><span data-i18n="events.role_worship_leader">Worship Leader</span></option>
                                <option value="speaker" data-i18n="events.role_speaker">Speaker</option>
                                <option value="nursery" data-i18n="events.role_nursery">Nursery</option>
                                <option value="parking" data-i18n="events.role_parking">Parking</option>
                                <option value="security" data-i18n="events.role_security">Security</option>
                                <option value="other" data-i18n="events.role_other">Other</option>
                            </select>
                        </div>
                        <div class="form-group" id="custom-role-group" style="display: none;">
                            <label for="custom-role-input" data-i18n="events.custom_role_name">Custom Role Name</label>
                            <input type="text" id="custom-role-input" class="form-control" data-i18n-placeholder="events.placeholder_custom_role" placeholder="Enter custom role">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeSelectRoleModal()" data-i18n="common.buttons.cancel">Cancel</button>
                            <button type="submit" class="btn btn-primary" data-i18n="events.join_event">Join Event</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Timestamp-based cache busting
        const cacheBust = Date.now();
        document.write('<script src="/js/i18n.js?t=' + cacheBust + '"><\/script>');
        document.write('<script src="/js/role-management.js?t=' + cacheBust + '"><\/script>');
        document.write('<script src="/js/edit-role-functions.js?t=' + cacheBust + '"><\/script>');
        document.write('<script src="/js/recurring-events.js?t=' + cacheBust + '"><\/script>');
        document.write('<script src="/js/app-user.js?t=' + cacheBust + '"><\/script>');
    </script>
</body>
</html>
