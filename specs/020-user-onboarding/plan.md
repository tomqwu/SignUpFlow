# Implementation Plan: User Onboarding System

**Branch**: `020-user-onboarding` | **Date**: 2025-10-23 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/020-user-onboarding/spec.md`

**Note**: This plan was generated by the `/speckit.plan` command workflow.

## Summary

User onboarding system guides new organization administrators through essential setup with step-by-step wizard (5 steps: organization profile, first event, first team, volunteer invitations, tutorial introduction), interactive tutorials with overlay tooltips, sample data generation (5 events, 3 teams, 15 volunteers, 1 generated schedule), progress checklist (6 key tasks with visual completion tracking), quick start videos (2-3 minutes each for essential workflows), progressive feature disclosure (unlock advanced features after proficiency milestones), skip option for experienced users, onboarding state persistence and resumption, and analytics tracking (completion rate, drop-off points, time-to-first-value). Target: Increase activation rate from 35% to 65%, reduce time-to-first-value from 2 hours to 15 minutes, reduce support tickets by 70%, achieve 75% wizard completion rate.

## Technical Context

**Language/Version**: Python 3.11+ (backend wizard state), JavaScript ES6+ (frontend wizard UI, tutorial overlays)
**Primary Dependencies**: FastAPI (API endpoints), SQLAlchemy (onboarding state persistence), JavaScript (tutorial overlay library like Shepherd.js or Intro.js), HTML5 Video API (quick start videos)
**Storage**: PostgreSQL (onboarding_state, checklist_tasks, tutorial_completions, sample_data metadata)
**Testing**: Pytest (unit tests for wizard logic), Playwright (E2E tests for wizard flow, tutorial overlays, sample data generation)
**Target Platform**: Web application (browser-based wizard and tutorials)
**Project Type**: Web application (backend wizard state management + frontend interactive UI)
**Performance Goals**: <2s wizard step transitions, <500ms checklist updates, <3s sample data generation, <5s sample data clearing, video playback start <1s
**Constraints**: Sample data must be clearly labeled, wizard must save partial progress, tutorials must not block UI, onboarding state per-organization (not per-admin), 30-day sample data expiration
**Scale/Scope**: 10-50 new organizations per week, 100-500 total organizations, 6 checklist tasks, 5 interactive tutorials, 5 quick start videos, 3 proficiency milestones for progressive disclosure

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

**Principle Compliance Analysis**:

✅ **Library-First**: Onboarding wizard implemented using established UI library (Shepherd.js for tutorial overlays, existing SignUpFlow router for step navigation), sample data generator as standalone service class in `api/services/onboarding_service.py`, independently testable wizard state machine with clear separation between UI (frontend) and state management (backend).

✅ **Test-First (NON-NEGOTIABLE)**: TDD approach: Write unit tests for wizard state machine transitions (step validation, progress tracking, resume logic) → User approves test coverage → Tests fail (no implementation) → Implement wizard state service to make tests pass → Integration tests for wizard API endpoints → E2E tests for complete wizard flow, tutorial interactions, sample data generation and cleanup.

✅ **Integration Testing**: Required for: Wizard API endpoints (GET/PUT onboarding state), sample data generation service (creates realistic events, teams, volunteers, schedules), tutorial overlay library integration (Shepherd.js step progression), video playback (HTML5 Video API), checklist state synchronization (real-time updates as tasks complete).

✅ **Observability**: Structured logging for all onboarding events (wizard step transitions, tutorial completions, sample data actions, feature unlocks, skip events) with organization_id for correlation, analytics event tracking for funnel analysis (completion rates, drop-off points, time-to-first-value), error logging for wizard validation failures and sample data generation issues.

✅ **Simplicity**: Start with simple wizard state machine (5 linear steps), basic tutorial overlay with Shepherd.js (avoid building custom overlay system), straightforward sample data generation (fixed templates, no AI generation), simple checklist progress tracking (6 boolean flags), YAGNI: defer advanced features like A/B testing wizard flows, dynamic video recommendations, personalized onboarding paths, session recordings until core wizard proven effective.

**Gate Status**: ✅ PASS - No constitution violations. Onboarding system follows established SignUpFlow patterns (service classes in `api/services/`, frontend JavaScript for UI, PostgreSQL for state persistence). Test-first approach mandatory for critical user flows (first-time experience directly impacts activation rates). Library-first approach leverages Shepherd.js for tutorial overlays avoiding custom overlay implementation.

## Project Structure

### Documentation (this feature)

```
specs/020-user-onboarding/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (wizard flow design, tutorial library comparison, sample data strategy)
├── data-model.md        # Phase 1 output (OnboardingState, ChecklistTask, TutorialCompletion schemas)
├── quickstart.md        # Phase 1 output (5-minute wizard development guide)
└── contracts/           # Phase 1 output (wizard API endpoints, analytics events)
    ├── wizard-api.md    # GET/PUT /api/onboarding/wizard
    ├── checklist-api.md # GET/PUT /api/onboarding/checklist
    ├── sample-data-api.md # POST /api/onboarding/sample-data, DELETE /api/onboarding/sample-data
    └── analytics-api.md # POST /api/analytics/onboarding-events
```

### Source Code (repository root)

```
# Web application structure (backend + frontend)
api/                               # Backend FastAPI application
├── services/
│   ├── onboarding_service.py      # OnboardingService class (wizard state, sample data generation)
│   └── sample_data_generator.py   # SampleDataGenerator (realistic test data)
├── routers/
│   ├── onboarding.py              # Onboarding API endpoints (wizard state, checklist, sample data)
│   └── analytics.py               # Analytics event tracking (onboarding funnel, drop-offs)
├── models.py                      # Add: OnboardingState, OnboardingChecklistTask, OnboardingTutorialCompletion, OnboardingMetric
├── utils/
│   └── wizard_validator.py       # Wizard step validation logic

frontend/                          # Frontend SPA
├── js/
│   ├── onboarding-wizard.js       # Wizard UI logic (step progression, validation)
│   ├── tutorial-overlay.js        # Shepherd.js tutorial integration
│   ├── sample-data-manager.js     # Sample data UI controls
│   └── onboarding-dashboard.js    # Onboarding dashboard with checklist and videos
├── css/
│   ├── wizard.css                 # Wizard step styles
│   └── tutorial-overlay.css       # Tutorial tooltip and overlay styles
└── videos/                        # Quick start video files (or links to hosted videos)
    ├── create-event.mp4           # "Creating Your First Event (2 min)"
    ├── invite-volunteers.mp4      # "Inviting Volunteers (2 min)"
    ├── run-solver.mp4             # "Running the Solver (3 min)"
    ├── manage-schedules.mp4       # "Managing Schedules (3 min)"
    └── advanced-features.mp4      # "Advanced Features (3 min)"

tests/
├── unit/
│   ├── test_onboarding_service.py # Unit tests for OnboardingService (wizard state machine)
│   ├── test_sample_data_generator.py # Sample data generation logic tests
│   └── test_wizard_validator.py   # Wizard validation logic tests
├── integration/
│   ├── test_onboarding_api.py     # Onboarding API endpoint tests
│   ├── test_sample_data_creation.py # Sample data integration tests (DB creates)
│   └── test_analytics_tracking.py # Analytics event logging tests
└── e2e/
    ├── test_wizard_flow.py        # E2E: Complete wizard from start to finish
    ├── test_tutorial_overlays.py  # E2E: Tutorial interactions and progression
    ├── test_sample_data_workflow.py # E2E: Generate, explore, clear sample data
    └── test_checklist_progression.py # E2E: Checklist task completion and updates

migrations/                        # Alembic database migrations
└── versions/
    └── add_onboarding_tables.py   # Add onboarding-related tables to database
```

**Structure Decision**: Web application architecture selected because user onboarding requires both backend state management (wizard progress persistence, sample data generation, analytics tracking) and frontend interactive UI (wizard steps, tutorial overlays, video playback, checklist visualization). Backend implements wizard state machine with step validation, sample data generator service creating realistic test data, and analytics event logging. Frontend implements wizard navigation UI, Shepherd.js tutorial overlays, video player with chapters, and real-time checklist progress updates.

## Complexity Tracking

*No constitution violations requiring justification.*

## Next Steps

**Phase 0: Research (Next)**
- Compare tutorial overlay libraries (Shepherd.js vs Intro.js vs Driver.js vs custom implementation)
- Design wizard flow architecture (linear vs branching, step validation strategy, progress persistence)
- Research sample data generation strategy (fixed templates vs randomized realistic data)
- Analyze checklist task detection logic (how to determine task completion automatically)
- Investigate progressive feature disclosure patterns (milestone detection, feature unlock UX)
- Research video hosting options (self-hosted vs YouTube/Vimeo embedded)
- Analyze onboarding analytics tracking (events to capture, funnel visualization)
- Document wizard state persistence patterns (resume flow, partial progress handling)

**Phase 1: Design & Contracts**
- Generate `data-model.md` with database schemas for OnboardingState, OnboardingChecklistTask, OnboardingTutorialCompletion, OnboardingMetric entities
- Create API contracts in `contracts/` directory:
  - `wizard-api.md`: Wizard state endpoints (GET/PUT /api/onboarding/wizard)
  - `checklist-api.md`: Checklist progress (GET/PUT /api/onboarding/checklist)
  - `sample-data-api.md`: Sample data management (POST/DELETE /api/onboarding/sample-data)
  - `analytics-api.md`: Analytics tracking (POST /api/analytics/onboarding-events)
- Generate `quickstart.md` with 5-minute wizard development guide (Shepherd.js setup, first wizard step)
- Update agent context by running `.specify/scripts/bash/update-agent-context.sh claude`

**Phase 2: Task Breakdown**
- Run `/speckit.tasks` to generate implementation tasks organized by user story
- Prioritize P1 tasks: Wizard flow, sample data generation, checklist
- Defer P3 tasks: Progressive disclosure, analytics optimization, session recordings

---

**Constitution Re-check Required**: After Phase 1 design complete, verify no new complexity introduced that violates simplicity or test-first principles.
